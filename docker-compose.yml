services:
  abiotic:
    # Use 'host' network mode for best performance and simple port management
    # Ensure Oracle Cloud Security List allows Ingress UDP/TCP on 7777 and 27015
    network_mode: "host"
    user: "0:0"
    build: .
    container_name: abiotic-factor
    restart: unless-stopped
    environment:
      # ---- Wine/Box64 settings (Optimized for ARM64) ----
      WINEDEBUG: "-all"
      WINEESYNC: "1"
      WINEFSYNC: "1"
      ARM64_DEVICE: "adlink"

      # ---- Server config ----
      MAX_PLAYERS: "6"
      SERVER_NAME: "My Abiotic Server"
      SERVER_PASSWORD: "ChangeMe123"      # CHANGE THIS!
      WORLD_SAVE_NAME: "Cascade"

      # ---- Behavior toggles ----
      UPDATE_ON_START: "1"   # Update server on container start
      VALIDATE: "0"          # Set to 1 if you suspect corruption
      BACKUP_ON_START: "1"   # Create backup before starting
      BACKUP_KEEP: "5"       # Number of backups to keep

      LOGGING: "0"
      WARMUP_SECONDS: "0"
    volumes:
      # Persistent data
      - ./server:/home/steam/abiotic:Z
      - ./data:/home/steam/abiotic/AbioticFactor/Saved:Z
      - ./steam:/home/steam/Steam:Z
      - ./backups:/backups:Z
      
      # Time sync
      - /etc/localtime:/etc/localtime:ro
    ulimits:
      nofile:
        soft: 1048576
        hard: 1048576
